<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Content Manager</title>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
</head>
<body>
  <!-- Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
  
  <!-- Custom Configuration -->
  <script>
    // Custom Preview Styles
    CMS.registerPreviewStyle("/styles/preview.css");
    
    // Blog Post Preview Template
    var PostPreview = createClass({
      render: function() {
        var entry = this.props.entry;
        var image = entry.getIn(['data', 'heroImage']);
        var imageAlt = entry.getIn(['data', 'heroImageAlt']) || '';
        var bg = this.props.getAsset(image);
        var title = entry.getIn(['data', 'title']);
        var description = entry.getIn(['data', 'description']);
        var date = entry.getIn(['data', 'pubDate']);
        var author = entry.getIn(['data', 'author']);
        var categories = entry.getIn(['data', 'categories']);
        var tags = entry.getIn(['data', 'tags']);
        
        return h('div', {className: 'preview-container', style: {padding: '40px', maxWidth: '800px', margin: '0 auto'}},
          h('article', {},
            // Header
            h('header', {style: {marginBottom: '2rem'}},
              categories && h('div', {style: {marginBottom: '1rem'}},
                categories.map(function(cat, i) {
                  return h('span', {
                    key: i,
                    style: {
                      display: 'inline-block',
                      padding: '4px 12px',
                      marginRight: '8px',
                      background: '#3b82f6',
                      color: 'white',
                      borderRadius: '4px',
                      fontSize: '0.875rem'
                    }
                  }, cat);
                })
              ),
              h('h1', {style: {
                fontSize: '2.5rem',
                fontWeight: 'bold',
                marginBottom: '1rem',
                lineHeight: '1.2'
              }}, title),
              h('p', {style: {
                fontSize: '1.125rem',
                color: '#6b7280',
                marginBottom: '1rem'
              }}, description),
              h('div', {style: {
                display: 'flex',
                gap: '1rem',
                fontSize: '0.875rem',
                color: '#6b7280'
              }},
                h('span', {}, 'By ' + author),
                date && h('time', {}, new Date(date).toLocaleDateString())
              )
            ),
            
            // Featured Image
            bg && h('img', {
              src: bg.toString(),
              alt: imageAlt,
              style: {
                width: '100%',
                height: 'auto',
                borderRadius: '8px',
                marginBottom: '2rem'
              }
            }),
            
            // Content
            h('div', {
              className: 'content prose prose-lg',
              style: {
                fontSize: '1.125rem',
                lineHeight: '1.75'
              }
            }, this.props.widgetFor('body')),
            
            // Tags
            tags && h('footer', {style: {marginTop: '3rem', paddingTop: '2rem', borderTop: '1px solid #e5e7eb'}},
              h('div', {style: {display: 'flex', flexWrap: 'wrap', gap: '8px'}},
                tags.map(function(tag, i) {
                  return h('span', {
                    key: i,
                    style: {
                      display: 'inline-block',
                      padding: '4px 12px',
                      background: '#f3f4f6',
                      color: '#374151',
                      borderRadius: '9999px',
                      fontSize: '0.875rem'
                    }
                  }, '#' + tag);
                })
              )
            )
          )
        );
      }
    });
    
    // Author Preview Template
    var AuthorPreview = createClass({
      render: function() {
        var entry = this.props.entry;
        var avatar = entry.getIn(['data', 'avatar']);
        var avatarUrl = this.props.getAsset(avatar);
        var name = entry.getIn(['data', 'name']);
        var bio = entry.getIn(['data', 'bio']);
        var title = entry.getIn(['data', 'title']);
        var social = entry.getIn(['data', 'social']);
        
        return h('div', {className: 'author-preview', style: {padding: '40px', maxWidth: '600px', margin: '0 auto', textAlign: 'center'}},
          avatarUrl && h('img', {
            src: avatarUrl.toString(),
            alt: name,
            style: {
              width: '150px',
              height: '150px',
              borderRadius: '50%',
              marginBottom: '1.5rem',
              objectFit: 'cover'
            }
          }),
          h('h1', {style: {fontSize: '2rem', fontWeight: 'bold', marginBottom: '0.5rem'}}, name),
          title && h('p', {style: {fontSize: '1.125rem', color: '#6b7280', marginBottom: '1rem'}}, title),
          h('p', {style: {fontSize: '1rem', lineHeight: '1.75', marginBottom: '2rem'}}, bio),
          social && h('div', {style: {display: 'flex', justifyContent: 'center', gap: '1rem'}},
            social.get('twitter') && h('a', {href: 'https://twitter.com/' + social.get('twitter'), target: '_blank'}, 'Twitter'),
            social.get('github') && h('a', {href: 'https://github.com/' + social.get('github'), target: '_blank'}, 'GitHub'),
            social.get('linkedin') && h('a', {href: social.get('linkedin'), target: '_blank'}, 'LinkedIn')
          )
        );
      }
    });
    
    // Register preview templates
    CMS.registerPreviewTemplate("blog", PostPreview);
    CMS.registerPreviewTemplate("authors", AuthorPreview);
    
    // Custom event handlers
    CMS.init({
      config: {
        load_config_file: true
      }
    });
    
    // Success message
    console.log('âœ… Decap CMS loaded successfully with custom previews');
  </script>
  
  <style>
    /* Preview styles */
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
    }
  </style>
</body>
</html>
